= SDD 0005 - Crossplane Service Provisioning

:sdd_author:    Marco Fretz
:sdd_owner:     Marco Fretz
:sdd_reviewers: 
:sdd_date:      2019-10-18
:sdd_status:    speculative
include::partial$meta-info-table.adoc[]

[NOTE]
.Summary
====
On a VSHN SYN enabled cluster services can automatically be provisioned and are then managed by VSHN, e.g. Database Service, Cache, S3, etc.
====

== Motivation

One should be able to provision a service the way way, independent of the underlying platform and infrastructure.

=== Goals

* In a application deployment one can define a service (e.g. MySQL DB Instance) which is then automatically provisioned and VSHN managed
* Via GitOps or by any other means that creates kubernetes API objects one can define a service (e.g. MySQL DB Instance) which is then automatically provisioned and VSHN managed
    
=== Non-Goals

* How such automatically provisioned services are brought into the VSHN managed state (monitored, backed-up, automatic maintenance, etc.)

== Design Proposal

* Independent of the cloud provider a logic will decide whether it provisions (and manages) a service offered by the cloud provider or has to setup the service on the Kubernetes cluster itself
* Services are defined by an Application deployment (by creating Kubernetes API objects, CRDs) or via a separate GitOps repositories (VSHN managed or customer)

image::crossplane_service_provisioning.png[]

. Custom Resource is created in the Kubernetes API (e.g. MySQLInstance)
. Crossplane reacts on this resource and makes sure the service is provisioned
. The Monitoring Operator (tbd) adds the service automatically to the monitoring
. A VSHN Agent / Operator sees the services and registers it in the VSHN Inventory for billing, maintenance, etc.

This is done as part of an Application deployment (usually with CI/CD pipelines) or with additional customer specific GitOps.

* Defining Service Instances used by Applications or directly is never done in the platform configuration management
* But the platform configuration management may define Crossplane services to be used by other platform services (e.g. Elasticsearch service used for central logging)

=== User Stories [optional]

=== Implementation Details/Notes/Constraints [optional]

=== Risks and Mitigations [optional]

== Drawbacks [optional]

== Alternatives [optional]

== References
