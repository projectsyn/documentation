= SSD 0010 - Syn Overall Concept

:sdd_author:    Marco Fretz & Tobias Brunner
:sdd_owner:     Tobias Brunner
:sdd_reviewers: 
:sdd_date:      2019-10-21
:sdd_status:    speculative
include::partial$meta-info-table.adoc[]

[NOTE]
.Summary
====
This is the overall SYN design overview. SYN consists of a lot of components which are designed and documented in their own design definitions (aka xref:0001-sdd-definition.adoc[SDD 001 - SDD Definition]).
====

== Motivation

As this is SYN itself, the reasons and motivation is described in detail in https://wiki.vshn.net/display/SYN/The+VSHN+Syn+Project[The VSHN Syn Project] itself already.

=== Goals

Automatic provisioning, configuration, maintenance, security, monitoring and backup for the Managed Platform, Managed Service and Managed Application Layers (see xref:0003-management-layers.adoc[SDD 0003 - Management Layers]).

== Design Proposal

image::concept_1.png[]

=== Configuration Management

==== Platform

* New _Platforms_ are registered in the xref:0007-lieutenant-management-api.adoc[SDD 0007 - Lieutenant - Management API] by the xref:0009-steward-cluster-agent.adoc[SDD 0009 - Steward Cluster Agent].
* For registered _Platforms_ a configuration catalog is generated by the xref:0008-platform-configuration-management.adoc[SDD 0008 - Platform Configuration Management]
* The catalog is continuously applied by GitOps to the _Platform_

==== Application

* Another instance of Configuration Management similar to xref:0008-platform-configuration-management.adoc[SDD 0008 - Platform Configuration Management] could be used to standardize SaaS deployments cross-customer / VSHN wide.
* _On registered_ Platforms applications can be deployed by any method, see xref:0004-application-deployments.adoc[SDD 0004 - Application deployments]
* Applications can also be VSHN or Reseller SaaS offerings

=== Provisioning

==== Platform

Currently SYN does focus on adapting existing kubernetes cluster, not on provisioning them. 

* Rancher provisioned and managed Cluster
* BYOC (Bring your own clsuter)
* Cloud provider provisioned Clusters (Google, AWS, Azure, etc.)
* OpenShift container platforms provisioned any method

[.status-macro .aui-lozenge .conf-macro .output-inline]#SPECULATIVE# This means the platform can be provisioned in several ways, for some the initial configuration could also be generated by the Platform Configuration Management (e.g. generated Rancher customer resources to tell Rancher to provision a new cluster) and used with crossplain cluster provisioning.

==== Managed Services

Managed services can be provisioned by defining Crossplane custom resources (Service Claims), see xref:0005-crossplane-service-provisioning.adoc[SDD 0005 - Crossplane Service Provisioning]

=== SYNsights (aka Monitoring)

* https://wiki.vshn.net/pages/viewpage.action?pageId=153846160[SDD#2019-10-25 - SYNsights Dashboards]
* https://wiki.vshn.net/pages/viewpage.action?pageId=153846140[SDD#2019-10-25 - SYNsights Metrics and Alerting]
* https://wiki.vshn.net/pages/viewpage.action?pageId=153846167[SDD#2019-10-25 - SYNsights Logging]
* https://wiki.vshn.net/pages/viewpage.action?pageId=153846431[SDD#2019-10-28 - SYNsights External Monitoring]
* Inlets and VSHN central reverse proxy to easily access services like Prometheus, Alertmanager, Grafana, Thanos, etc. → Roadmap
* Monitoring of Monitoring → Roadmap
** periodic heartbeats covering prometheus and alertmanager to VSHN central (synfra), alerts are created when heartbeats are missing
* [.status-macro .aui-lozenge .conf-macro .output-inline]#SPECULATIVE# Collecting metrics at VSHN central (synfra)
** A central prometheus (cluster) federating via inlets to (thanos) prometheus of each cluster, allowing us to have important metrics centrally and outside of each cluster

image::concept_2.png[]

=== Backup

Persistent data is backed up automatically using backup k8upa, backup operators and pre-backup scripts. More complex things like big databases, continuous backups and replication, point-in-time db recovery, etc. is something that is defined on a per service basis (product definition) and very specific to the service or technology used.

* https://wiki.vshn.net/pages/viewpage.action?pageId=153847068[SDD#2019-10-30 - Backup Framework]

=== Inventory and Billing

_This part is still highly speculative and needs more research, specific SDDs and decisions._

* A VSHN made object counter agent counts all object of a list of know Object-Kinds and sends some information to the inventory
** cluster it runs on (already registered with the inventory service
** type / kind
** annotations relevant for monitoring, billing, alerting, backup
* This helps VSHN to have an overview per customer / per service over what is running where fro who
* This allows to do billing of clusters and services using first-seen, last-seen and usage information

=== Security

* https://wiki.vshn.net/pages/viewpage.action?pageId=153846674[SDD#2019-10-29 - Secrets Management]

=== Maintenance

There are different layers where we need to do maintenance (keeping things up2date): https://wiki.vshn.net/pages/viewpage.action?pageId=153848259[SDD#2019-11-06 - Maintenance Overview].

With Renovate we can automatically have Git Merge Requests automatically created to keep use up2date helm charts, docker images, etc.: https://wiki.vshn.net/pages/viewpage.action?pageId=153847765[SDD#2019-11-05 - Maintenance with Renovate]
